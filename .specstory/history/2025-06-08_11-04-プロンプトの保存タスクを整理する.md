<!-- Generated by SpecStory -->

# プロンプトの保存タスクを整理する (2025-06-08 20:04:15)

_**User**_

まず、about-this-project.mdの内容をすべて把握してください。
その後、### レベル 1：プロンプトの保存　を実現するために必要なタスクを、todo形式で@レベル1_タスク詳細.md に記述してください。

---

_**Assistant**_



---

まず、`about-this-project.md`の内容を把握しました。

このプロジェクトは「Prompt Template Manager」というVS Code拡張機能の開発で、AIを使用した開発を快適にすることを目的としています。レベル1では「プロンプトの保存」機能を実現する必要があり、ユーザーが良く使うプロンプトを保存・編集でき、使用回数順に並べて表示する機能が求められています。

それでは、レベル1を実現するために必要なタスクをTODO形式で`レベル1_タスク詳細.md`に記述します。

---

```diff
- 
+ # レベル1：プロンプトの保存 - タスク詳細
+ 
+ ## 概要
+ ユーザーは良く使うプロンプトを保存・編集することができます。
+ 保存したプロンプトは上から使用回数順に並べられており、スクロールして目的のプロンプトを探すことができます。
+ 
+ ## TODO リスト
+ 
+ ### 1. プロジェクト基盤の構築
+ - [ ] VS Code拡張機能の基本プロジェクト構造を作成
+ - [ ] package.jsonの設定（拡張機能の基本情報、コマンド定義）
+ - [ ] TypeScriptの設定とビルド環境の構築
+ - [ ] 基本的なactivation eventの定義
+ 
+ ### 2. データ構造の設計
+ - [ ] プロンプトデータの型定義作成
+   - [ ] プロンプトID
+   - [ ] プロンプトタイトル
+   - [ ] プロンプト内容
+   - [ ] 使用回数
+   - [ ] 作成日時
+   - [ ] 更新日時
+ - [ ] プロンプト一覧を管理するデータ構造の設計
+ 
+ ### 3. データ永続化の実装
+ - [ ] VS Codeのワークスペース設定を使用したデータ保存機能
+ - [ ] プロンプトデータの読み込み機能
+ - [ ] プロンプトデータの書き込み機能
+ - [ ] データの初期化処理
+ 
+ ### 4. UI/UXの実装
+ - [ ] プロンプト一覧表示のWebviewパネル作成
+ - [ ] 新しいプロンプト追加ボタンの実装
+ - [ ] プロンプト編集ダイアログの実装
+ - [ ] プロンプト削除機能の実装
+ - [ ] プロンプト一覧のスクロール機能
+ 
+ ### 5. プロンプト管理機能
+ - [ ] 新規プロンプト作成機能
+ - [ ] プロンプト編集機能（タイトル、内容の変更）
+ - [ ] プロンプト削除機能
+ - [ ] 使用回数カウント機能
+ - [ ] 使用回数順での並び替え機能
+ 
+ ### 6. バリデーションとエラーハンドリング
+ - [ ] プロンプトタイトルの重複チェック
+ - [ ] 空のプロンプト入力に対するバリデーション
+ - [ ] データ保存失敗時のエラーハンドリング
+ - [ ] 不正なデータ形式に対するエラーハンドリング
+ 
+ ### 7. ユーザビリティの向上
+ - [ ] プロンプト一覧の検索機能（レベル2の準備）
+ - [ ] プロンプトのプレビュー機能
+ - [ ] キーボードショートカットの実装
+ - [ ] 操作結果の通知表示
+ 
+ ### 8. テストとデバッグ
+ - [ ] 基本機能のテストケース作成
+ - [ ] データ永続化のテスト
+ - [ ] UI操作のテスト
+ - [ ] エラーケースのテスト
+ 
+ ### 9. ドキュメントとパッケージング
+ - [ ] README.mdの作成
+ - [ ] 拡張機能の説明とスクリーンショット
+ - [ ] バージョン管理とリリース準備
+ - [ ] VS Code Marketplaceへの公開準備
+ 
+ ## 完了条件
+ - ユーザーがプロンプトを保存できる
+ - 保存したプロンプトを編集できる
+ - プロンプト一覧が使用回数順に表示される
+ - プロンプトをスクロールして探すことができる
+ - データが永続化される
+ 
```

---

`about-this-project.md`の内容を把握し、レベル1「プロンプトの保存」を実現するために必要なタスクを詳細なTODOリストとして`レベル1_タスク詳細.md`に記述しました。

このタスクリストには以下の要素が含まれています：

1. **プロジェクト基盤の構築** - VS Code拡張機能の基本セットアップ
2. **データ構造の設計** - プロンプトデータの型定義と管理構造
3. **データ永続化の実装** - プロンプトデータの保存・読み込み機能
4. **UI/UXの実装** - Webviewパネルとユーザーインターフェース
5. **プロンプト管理機能** - CRUD操作と使用回数管理
6. **バリデーションとエラーハンドリング** - データの整合性とエラー対応
7. **ユーザビリティの向上** - 検索機能やキーボードショートカット
8. **テストとデバッグ** - 品質保証のためのテスト実装
9. **ドキュメントとパッケージング** - リリース準備

各カテゴリーは段階的に実装できるよう構成されており、最終的にレベル1の完了条件（プロンプトの保存・編集・使用回数順表示・スクロール検索・データ永続化）を満たせるようになっています。

---

_**User**_

ワークスペース設定を利用すると、ワークスペースが変更されたときに保存していたプロンプトが使用できなくなると思うのですが、この認識は正しいですか？

---

_**Assistant**_



---

はい、その認識は正しいです！

VS Codeのワークスペース設定を使用すると、設定データは特定のワークスペース（プロジェクトフォルダ）の`.vscode/settings.json`ファイルに保存されます。これは以下の問題を引き起こします：

1. **ワークスペース依存**: 保存したプロンプトは、そのワークスペースでのみ利用可能
2. **移植性の欠如**: 別のプロジェクトに移動すると、以前に保存したプロンプトが使用できない
3. **共有の困難**: チームメンバーとプロンプトを共有したい場合に不便

プロンプトテンプレートマネージャーのようなツールでは、ユーザーが作成したプロンプトは**すべてのプロジェクトで利用できる**べきです。

より適切な代替案は以下の通りです：

## 推奨される代替案

### 1. **VS Code Extension Storage API** （最推奨）
```typescript
// グローバルに保存され、すべてのワークスペースで利用可能
context.globalState.update('prompts', promptData);
```

### 2. **VS Codeのグローバル設定**
```typescript
// ユーザー設定ファイルに保存
vscode.workspace.getConfiguration().update('promptTemplateManager.prompts', promptData, vscode.ConfigurationTarget.Global);
```

### 3. **ユーザーディレクトリの専用ファイル**
```typescript
// ~/.vscode/extensions/prompt-templates.json など
```

`レベル1_タスク詳細.md`の該当部分を修正することをお勧めします。Extension Storage APIを使用することで、ユーザーの期待に沿った動作を実現できます。

---

_**User**_

ありがとうございます。それでは、@レベル1_タスク詳細.md の該当部分の修正をお願いします。

---

_**Assistant**_



---

`レベル1_タスク詳細.md`の「データ永続化の実装」部分を修正いたします。

---

```diff
  ### 3. データ永続化の実装
  
- - [ ] VS Code のワークスペース設定を使用したデータ保存機能
+ - [ ] VS Code Extension Storage API を使用したグローバルデータ保存機能
+   - [ ] context.globalState を使用したプロンプトデータの保存
+   - [ ] 全ワークスペース共通でアクセス可能なデータ管理
  - [ ] プロンプトデータの読み込み機能
+   - [ ] 拡張機能起動時のデータ読み込み処理
+   - [ ] データが存在しない場合の初期化処理
  - [ ] プロンプトデータの書き込み機能
- - [ ] データの初期化処理
+   - [ ] プロンプト作成・編集・削除時のデータ保存
+   - [ ] データ保存の非同期処理とエラーハンドリング
+ - [ ] データのバックアップとマイグレーション機能
+   - [ ] 設定データのエクスポート機能（将来的な拡張のため）
+   - [ ] データ形式のバージョン管理
  
  ### 4. UI/UX の実装
```

---

修正完了しました！

「データ永続化の実装」セクションを以下のように改善しました：

1. **VS Code Extension Storage API の使用**: `context.globalState`を使用してグローバルにデータを保存し、全ワークスペースで共通利用可能にしました

2. **詳細なタスク分解**: 読み込み・書き込み機能をより具体的なサブタスクに分割しました

3. **将来性の考慮**: データのバックアップやマイグレーション機能も追加し、拡張機能の長期的な運用を見据えた設計にしました

これにより、ユーザーが保存したプロンプトはワークスペースに依存せず、どのプロジェクトでも利用できるようになります。VS Code Extension Storage APIを使用することで、データの永続化と移植性の両方を実現できます。

---

_**User**_

@レベル1_タスク詳細.md 

ありがとうございます。UI/UXについてですが、私の提示した@完成イメージ.png 歯確認しましたか？確認したうえで、このタスクなのであれば問題ありませんが、確認していないのであれば確認したうえでタスクを修正してください。

---

_**Assistant**_



---



---



---



---



---

